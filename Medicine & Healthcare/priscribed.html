<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prescribed Medicines - DEMO GOODNEEWZ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/header.css">
    <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#36C2CE',
            secondary: '#0ea5e9',
            accent: '#10b981',
            dark: '#1e293b',
          }
        }
      }
    }
  </script>
  <style>
    .product-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid #e5e7eb !important;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
      cursor: pointer;
    }
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .product-image {
      object-fit: contain;
      width: 100%;
      height: 160px;
    }
    .floating-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }
    .floating-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    .prescription-card {
      border: 2px dashed #36C2CE;
      background-color: #f0fdff;
      transition: all 0.3s ease;
    }
    .prescription-card:hover {
      background-color: #e0f7fa;
      border-color: #0ea5e9;
    }
  </style>
</head>
<body class="bg-gray-50" onload="initializePage()">
  <!-- Header (unchanged) -->
  <div id="header-placeholder"></div>

  <!-- HERO BANNER -->
  <section class="hero-banner h-96 bg-cover bg-center bg-no-repeat" 
           style="background-image: url('https://i.pinimg.com/1200x/b3/75/ee/b375ee913e729ba6567db170935b9d07.jpg');">
  </section>


  <!-- Main Content -->
  <div class="container mx-auto px-4 py-6">
    <!-- Sorting and Filter Controls -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm">
      <div class="text-sm text-gray-600 mb-2 md:mb-0">
        Showing <span id="productCount" class="font-semibold">91</span> products
      </div>
      <div class="flex items-center space-x-4">
        <select class="border border-gray-300 p-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary" id="sortSelect">
          <option>Sort By: Relevance</option>
          <option>Price: Low to High</option>
          <option>Price: High to Low</option>
        </select>
      </div>
    </div>

    <!-- Product Grid -->
    <section>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productGrid"></div>
    </section>
  </div>

  <!-- Floating Upload Button -->
  <button id="floatingUploadBtn" class="floating-button bg-primary hover:bg-secondary text-white py-3 px-5 rounded-full font-semibold flex items-center gap-2">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
    Upload Prescription
  </button>

<!-- Upload Prescription Modal -->
<div id="uploadModal" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto relative">
   
    <!-- Close Button -->
    <button onclick="document.getElementById('uploadModal').classList.add('hidden')"
            class="absolute top-3 right-3 text-gray-500 hover:text-black text-xl font-bold z-10">
      âœ•
    </button>

    <div class="p-6 pb-8 md:p-8">
      <div class="flex flex-col space-y-6 md:space-y-0 md:flex-row md:gap-6">
        
        <!-- Left Section -->
        <div class="w-full md:w-1/2 border rounded-xl p-5 shadow-md">
          <h2 class="text-lg font-semibold mb-4 text-center md:text-left">Enjoy Easy and Hassle-Free Ordering</h2>
         
          <!-- Upload Box -->
          <label class="border rounded-lg p-4 mb-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition">
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 16v-8m0 0l-4 4m4-4l4 4M4 20h16"/>
              </svg>
              <span class="font-medium text-gray-700 text-sm sm:text-base">Upload Prescription</span>
            </div>
            <input type="file" class="hidden" accept="image/*" />
            <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </label>

          <!-- Valid Prescription Info (trigger button) -->
          <p id="validPrescriptionBtn" 
             class="text-sm text-blue-600 mb-3 flex items-center gap-1.5 cursor-pointer border-b border-blue-600 inline-block pb-0.5 w-fit hover:text-blue-800 transition">
            <svg class="w-4 h-4 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 100 20 10 10 0 000-20z"/>
            </svg>
            <span class="text-xs sm:text-sm">What is a valid prescription?</span>
          </p>

          <!-- Urgent Order Info Box -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-blue-700 font-semibold text-center">
            <p class="mb-3 text-xs sm:text-sm">For urgent orders, contact us directly:</p>
            <button onclick="window.location.href='tel:1234567890'"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition text-sm">
              ðŸ“ž 1234567890
            </button>
          </div>
        </div>

        <!-- Right Section -->
        <div class="w-full md:w-1/2">
          <h2 class="text-lg font-semibold mb-4 text-center md:text-left">How will the Pharmacist help you?</h2>
          <ul class="space-y-4 text-gray-700 text-sm">
            <li class="flex items-start gap-3">
              <img src="https://assets.pharmeasy.in/web-assets/images/uploadStep1.png?dim=48x48&q=75" alt="Step 1" class="w-10 h-10 flex-shrink-0">
              <span>Pharmacist will check items on prescription and add to cart</span>
            </li>
            <li class="flex items-start gap-3">
              <img src="https://assets.pharmeasy.in/web-assets/images/uploadStep2.png?dim=48x48&q=75" alt="Step 2" class="w-10 h-10 flex-shrink-0">
              <span>You can ask for additional items if needed</span>
            </li>
            <li class="flex items-start gap-3">
              <img src="https://assets.pharmeasy.in/web-assets/images/uploadStep3.png?dim=48x48&q=75" alt="Step 3" class="w-10 h-10 flex-shrink-0">
              <span>They will apply the best coupon & get you max savings</span>
            </li>
            <li class="flex items-start gap-3">
              <img src="https://assets.pharmeasy.in/web-assets/images/uploadStep4.png?dim=48x48&q=75" alt="Step 4" class="w-10 h-10 flex-shrink-0">
              <span>Choose the earliest delivery date</span>
            </li>
            <li class="flex items-start gap-3">
              <img src="https://assets.pharmeasy.in/web-assets/images/uploadStep5.png?dim=48x48&q=75" alt="Step 5" class="w-10 h-10 flex-shrink-0">
              <span>Finally, share payment method options</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Valid Prescription Modal -->
<div id="validPrescriptionModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto p-6 sm:p-8 md:p-12 relative">
    
    <!-- Close Button -->
    <button onclick="document.getElementById('validPrescriptionModal').classList.add('hidden')"
            class="absolute top-4 right-4 text-gray-500 hover:text-black text-xl font-bold z-10">
      âœ•
    </button>

    <!-- Modal Content -->
    <h2 class="text-xl font-semibold mb-6 text-center">A valid prescription contains:</h2>
    
    <!-- Icons Row -->
    <div class="grid grid-cols-2 gap-4 sm:gap-6 mb-6 text-center">
      <div class="flex flex-col items-center">
        <svg class="w-10 h-10 text-blue-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422A12.083 12.083 0 0118 20.944V21l-6-3-6 3v-.056a12.083 12.083 0 01-.16-10.366L12 14z"/>
        </svg>
        <span class="text-xs sm:text-sm font-medium">Doctor Details</span>
      </div>
      <div class="flex flex-col items-center">
        <svg class="w-10 h-10 text-green-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10m-11 4h12M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <span class="text-xs sm:text-sm font-medium">Date of Prescription</span>
      </div>
      <div class="flex flex-col items-center">
        <svg class="w-10 h-10 text-purple-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A9.969 9.969 0 0112 15c2.21 0 4.242.72 5.879 1.928M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span class="text-xs sm:text-sm font-medium">Patient Details</span>
      </div>
      <div class="flex flex-col items-center">
        <svg class="w-10 h-10 text-red-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-6h13V7H9V1L1 9l8 8z"/>
        </svg>
        <span class="text-xs sm:text-sm font-medium">Dosage Details</span>
      </div>
    </div>

    <!-- Divider -->
    <hr class="my-6 border-t-2 border-blue-500 rounded">

    <!-- Do's and Don'ts -->
    <h3 class="text-lg font-semibold mb-4 text-center sm:text-left">DO'S AND DON'Ts</h3>
    <ul class="space-y-3 text-xs sm:text-sm">
      <li class="flex items-start gap-2">
        <span class="text-green-600 font-bold text-lg">âœ”</span>
        <span><b>Upload Clear Image</b> â€” Ensure picture is taken with clear visible handwriting/type. Place prescription on a flat surface for better focus.</span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-red-600 font-bold text-lg">âœ˜</span>
        <span><b>No Picture of Medicines</b></span>
      </li>
      <li class="flex items-start gap-2">
        <span class="text-red-600 font-bold text-lg">âœ˜</span>
        <span><b>Do not crop the Image</b></span>
      </li>
    </ul>
  </div>
</div>
<!-- Footer Section -->
<footer class="bg-white text-dark py-4 border-t border-gray-200">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-6 text-center md:text-left">
      
      <!-- Company Info & Logo -->
      <div class="flex flex-col items-center md:items-start">
        <img src="/IMG/LOGO-removebg-preview.png" alt="Company Logo" class="h-16 w-auto mb-2">
        <p class="text-gray-600 text-sm leading-relaxed mb-2 max-w-xs">
          "Delivering trusted healthcare and wellness solutions. We're committed to providing quality medicines and exceptional care for every customer."
        </p>
        <p class="text-primary text-sm font-medium">Excellence in Every Detail</p>
      </div>
      
      <!-- Quick Links (Hidden on small screens) -->
      <div class="hidden md:block">
        <h3 class="text-base font-semibold mb-3 text-dark border-b-2 border-primary inline-block pb-1">Quick Links</h3>
        <ul class="space-y-1">
          <li><a href="index.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Home</a></li>
          <li><a href="about.html" class="text-gray-600 hover:text-primary transition-colors text-sm">About Us</a></li>
          <li><a href="/BABYCARE/baby.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Baby Care</a></li>
          <li><a href="/CONTACT.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Contact Us</a></li>
          <li><a href="/MOTHERCARE/mother.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Mother Care</a></li>
        </ul>
      </div>
      
      <!-- Policies -->
      <div class="flex flex-col items-center md:items-start">
        <h3 class="text-base font-semibold mb-3 text-dark border-b-2 border-primary inline-block pb-1">Policies</h3>
        <ul class="space-y-1">
          <li><a href="disclaimer.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Disclaimer</a></li>
          <li><a href="privacy.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Privacy Policy</a></li>
          <li><a href="refund.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Refund Policy</a></li>
          <li><a href="terms.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Terms of Service</a></li>
          <li><a href="disclaimer.html" class="text-gray-600 hover:text-primary transition-colors text-sm">Cancellation Policy</a></li>
        </ul>
      </div>
      
<!-- Contact Info -->
<div class="flex flex-col items-center md:items-start">
  <h3 class="text-base font-semibold mb-3 text-dark border-b-2 border-primary inline-block pb-2">Get in Touch</h3>
  <div class="space-y-1 mb-3">
    <div class="flex items-start justify-center md:justify-start text-gray-600 text-sm">
      <i class="fas fa-map-marker-alt text-primary mt-0.5 mr-2 text-xs"></i>
      <span>123 Business Street, Suite 100<br>Pimpri, Maharashtra, India</span>
    </div>
    <div class="flex items-center justify-center md:justify-start text-gray-600 text-sm">
      <i class="fas fa-envelope text-primary mr-2 text-xs"></i>
      <a href="mailto:info@yourcompany.com" class="hover:text-primary transition-colors">Shilpaghodke41@gmail.com</a>
    </div>
    <div class="flex items-center justify-center md:justify-start text-gray-600 text-sm">
      <i class="fas fa-phone-alt text-primary mr-2 text-xs"></i>
      <a href="tel:+91 91460 72858" class="hover:text-primary transition-colors">+91 91460 72858(Mrs.Shilpa Ghodke)</a><br>
     
    </div>
        <div class="flex items-center justify-center md:justify-start text-gray-600 text-sm">
      <i class="fas fa-phone-alt text-primary mr-2 text-xs"></i>
 <a href="tel:+91 84080 14111" class="hover:text-primary transition-colors">+91 84080 14111(Mr. Alok Gandhi)</a><br>     
    </div>
    <div class="flex items-start justify-center md:justify-start text-gray-600 text-sm">
      <i class="fas fa-clock text-primary mt-0.5 mr-2 text-xs"></i>
      <span>Mon - Fri: 9:00 AM - 6:00 PM</span>
    </div>
    
    <!-- New Line Added -->
    <div class="flex items-center justify-center md:justify-start text-gray-700 text-sm font-medium mt-3">
      <i class="fas fa-headset text-primary mr-2 text-base"></i>
      <span>Call <a href="tel:+918382058205" class="text-primary hover:underline font-bold">8382058205</a> for online consultation.</span>
    </div>
  </div>
        
</div>
 <!-- Bottom Bar â€“ PERFECTLY CENTERED -->
    <div class="col-span-full border-t border-gray-200 pt-4 mt-6">
      <p class="text-center text-xs text-gray-600">
        Â© <span id="year"></span> GOODNEEWZ. All rights reserved.
      </p>
    </div>
  </div>
</footer>

<script>
  // Dynamically set current year
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

  <!-- Header Loader (unchanged) -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      fetch('/header.html')
        .then(r => r.text())
        .then(html => {
          document.getElementById('header-placeholder').innerHTML = html;
          if (typeof initializeHeader === 'function') initializeHeader();
        });
    });
  </script>
  <script src="/header.js"></script>

  <!-- Main JS -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ================
      // Data: Only Rx Products
      // ================
      const products = [
        {
          "id": 1,
          "name": "Isoxsuprine Hydrochloride SR 40mg",
          "price": 85,
          "originalPrice": 100,
          "discount": "15% off",
          "category": "Women's Health",
          "brand": "Biofield Pharma",
          "image": "https://via.placeholder.com/300x200.png?text=Isoxsuprine+40mg",
          "prescriptionRequired": true
        },
        {
          "id": 2,
          "name": "Letrozole Tablet",
          "price": 120,
          "originalPrice": 150,
          "discount": "20% off",
          "category": "Women's Health",
          "brand": "Evapride",
          "image": "https://via.placeholder.com/300x200.png?text=Letrozole+Tablet",
          "prescriptionRequired": true
        },
        {
          "id": 3,
          "name": "Doxylamine Succinate Pyridoxine Hydrochloride and Folic Acid",
          "price": 95,
          "originalPrice": 110,
          "discount": "14% off",
          "category": "Women's Health",
          "brand": "Ultrableess Remedies Pvt Ltd",
          "image": "https://via.placeholder.com/300x200.png?text=Doxylamine+Combo",
          "prescriptionRequired": true
        },
        {
          "id": 4,
          "name": "Cefixime Tab 200mg",
          "price": 180,
          "originalPrice": 200,
          "discount": "10% off",
          "category": "Antibiotics",
          "brand": "Abbott Healthcare Pvt Ltd",
          "image": "https://via.placeholder.com/300x200.png?text=Cefixime+200mg",
          "prescriptionRequired": true
        },
        {
          "id": 5,
          "name": "Amoxycillin and Potassium Clavunate Tab IP",
          "price": 160,
          "originalPrice": 180,
          "discount": "11% off",
          "category": "Antibiotics",
          "brand": "Abbott",
          "image": "https://via.placeholder.com/300x200.png?text=Amoxycillin+Clavunate",
          "prescriptionRequired": true
        },
        {
          "id": 6,
          "name": "Tranexamic Acid 500mg and Mefenamic Acid 250mg",
          "price": 75,
          "originalPrice": 90,
          "discount": "17% off",
          "category": "Women's Health",
          "brand": "Biofield Pharma Pvt Ltd",
          "image": "https://via.placeholder.com/300x200.png?text=Tranexamic+Mefenamic",
          "prescriptionRequired": true
        },
        {
          "id": 7,
          "name": "Trypsin 48mg Bromelain 90mg and Rutoside Trihydrate 100mg",
          "price": 110,
          "originalPrice": 130,
          "discount": "15% off",
          "category": "Anti-inflammatory",
          "brand": "Flexicare CD",
          "image": "https://via.placeholder.com/300x200.png?text=Trypsin+Bromelain",
          "prescriptionRequired": true
        },
        {
          "id": 8,
          "name": "Natural Micronised Progesterone 200mg",
          "price": 140,
          "originalPrice": 160,
          "discount": "13% off",
          "category": "Women's Health",
          "brand": "Evapride Healthcare Pvt Ltd",
          "image": "https://via.placeholder.com/300x200.png?text=Progesterone+200mg",
          "prescriptionRequired": true
        },
        {
          "id": 9,
          "name": "Levonorgestrel 0.15mg Ethinyloestradiol 0.03mg",
          "price": 95,
          "originalPrice": 115,
          "discount": "17% off",
          "category": "Women's Health",
          "brand": "Lincoln Pharmaceutical Ltd",
          "image": "https://via.placeholder.com/300x200.png?text=Levonorgestrel+EE",
          "prescriptionRequired": true
        },
        {
          "id": 10,
          "name": "Azithromycin 250mg",
          "price": 125,
          "originalPrice": 150,
          "discount": "17% off",
          "category": "Antibiotics",
          "brand": "FDC Limited",
          "image": "https://via.placeholder.com/300x200.png?text=Azithromycin+250mg",
          "prescriptionRequired": true
        }
      ];

      // ================
      // DOM Elements
      // ================
      const productGrid = document.getElementById('productGrid');
      const sortSelect = document.getElementById('sortSelect');
      const uploadModal = document.getElementById('uploadModal');
      const validPrescriptionModal = document.getElementById('validPrescriptionModal');
      const floatingUploadBtn = document.getElementById('floatingUploadBtn');
      const prescriptionDropArea = document.getElementById('prescriptionDropArea');
      const prescriptionFile = document.getElementById('prescriptionFile');
      const productCount = document.getElementById('productCount');

      let activeSort = null;

      // ================
      // Helpers
      // ================
      function escapeHtml(str) {
        if (typeof str !== 'string') return str;
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
      }

      // ================
      // Product Card (No Buttons)
      // ================
      function createProductCard(product) {
        const div = document.createElement('div');
        div.className = 'product-card bg-white p-4 rounded-lg flex flex-col justify-between relative cursor-pointer hover:shadow-lg transition-shadow';

        div.innerHTML = `
          <div class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">Rx Required</div>
          <img src="${product.image}" alt="${escapeHtml(product.name)}" class="product-image w-full h-32 rounded-lg mb-3">
          <p class="text-sm text-gray-600 font-medium">${escapeHtml(product.name)}</p>
          <p class="text-xs text-gray-500">${escapeHtml(product.brand)}</p>
          <p class="text-red-600 text-xs mt-1 font-semibold">Prescription needed</p>
          <div class="mt-2">
            <p class="text-green-600 font-bold">â‚¹${product.price.toFixed(2)} 
              ${product.originalPrice ? `<span class="text-gray-500 line-through text-sm">â‚¹${product.originalPrice.toFixed(2)}</span> <span class="text-green-600 text-sm">${escapeHtml(product.discount)}</span>` : ''}</p>
          </div>
        `;

        // Click anywhere â†’ open modal
        div.addEventListener('click', () => {
          openUploadModalForProduct(product);
        });

        return div;
      }

      function displayProducts(list) {
        productGrid.innerHTML = '';
        list.forEach(p => productGrid.appendChild(createProductCard(p)));
        productCount.textContent = list.length;
      }

      displayProducts(products);

      // ================
      // Sorting
      // ================
      sortSelect?.addEventListener('change', () => { 
        activeSort = sortSelect.value; 
        applyFilters(products); 
      });

      function applyFilters(startList) {
        let list = [...(startList || products)];
        if (activeSort === 'Price: Low to High') list.sort((a,b) => a.price - b.price);
        else if (activeSort === 'Price: High to Low') list.sort((a,b) => b.price - a.price);
        displayProducts(list);
      }

      // ================
      // Upload Modal Logic
      // ================
      function openUploadModalForProduct(product) {
        if (!uploadModal) return;
        uploadModal.dataset.productId = product.id;
        document.getElementById('modalProductName').textContent = `Upload Prescription for: ${product.name}`;
        const img = document.getElementById('modalProductImage');
        if (img) { img.src = product.image; img.classList.remove('hidden'); }

        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const previewImg = document.getElementById('prescriptionPreviewImg');

        prescriptionFile.addEventListener('change', () => {
          const file = prescriptionFile.files[0];
          if (!file) { fileNameDisplay.textContent = ''; return; }
          fileNameDisplay.textContent = file.name;
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = e => {
              previewImg.src = e.target.result;
              previewImg.classList.remove('hidden');
              uploadModal.dataset.tempDataURL = e.target.result;
              uploadModal.dataset.tempFileName = file.name;
            };
            reader.readAsDataURL(file);
          } else {
            uploadModal.dataset.tempDataURL = '';
            uploadModal.dataset.tempFileName = file.name;
          }
        });

        uploadModal.classList.remove('hidden');
      }

      // Floating button click handler
      floatingUploadBtn.addEventListener('click', () => {
        uploadModal.classList.remove('hidden');
        uploadModal.dataset.productId = 'general';
      });

      // Drag and drop functionality
      prescriptionDropArea.addEventListener('click', () => {
        prescriptionFile.click();
      });

      prescriptionDropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        prescriptionDropArea.classList.add('bg-blue-50');
      });

      prescriptionDropArea.addEventListener('dragleave', () => {
        prescriptionDropArea.classList.remove('bg-blue-50');
      });

      prescriptionDropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        prescriptionDropArea.classList.remove('bg-blue-50');
        if (e.dataTransfer.files.length) {
          prescriptionFile.files = e.dataTransfer.files;
          const event = new Event('change', { bubbles: true });
          prescriptionFile.dispatchEvent(event);
        }
      });

      document.getElementById('submitPrescription')?.addEventListener('click', () => {
        const prodId = uploadModal.dataset.productId;
        const name = uploadModal.dataset.tempFileName;
        const data = uploadModal.dataset.tempDataURL;

        if (!name) return alert('Please select a file.');

        const prescriptions = JSON.parse(localStorage.getItem('prescriptions') || '{}');
        prescriptions[prodId] = { fileName: name, dataURL: data || null, uploadedAt: new Date().toISOString() };
        localStorage.setItem('prescriptions', JSON.stringify(prescriptions));

        uploadModal.classList.add('hidden');
        alert('Prescription uploaded successfully!');
        clearModal();
      });

      function clearModal() {
        delete uploadModal.dataset.tempDataURL;
        delete uploadModal.dataset.tempFileName;
        document.getElementById('fileNameDisplay').textContent = '';
        document.getElementById('prescriptionPreviewImg').classList.add('hidden');
        document.getElementById('prescriptionFile').value = '';
      }

      // Close modals
      uploadModal?.addEventListener('click', e => { 
        if (e.target === uploadModal) { 
          uploadModal.classList.add('hidden'); 
          clearModal(); 
        } 
      });
      
      document.getElementById('closeUploadModal')?.addEventListener('click', () => { 
        uploadModal.classList.add('hidden'); 
        clearModal(); 
      });

      validPrescriptionModal?.addEventListener('click', e => { 
        if (e.target === validPrescriptionModal) validPrescriptionModal.classList.add('hidden'); 
      });
      
      document.getElementById('closeValidPrescriptionModal')?.addEventListener('click', () => validPrescriptionModal.classList.add('hidden'));

      // Valid prescription info button
      document.getElementById('validPrescriptionBtn')?.addEventListener('click', () => validPrescriptionModal.classList.remove('hidden'));

      // Expose
      window.uploadPrescription = (obj) => {
        const p = typeof obj === 'object' ? obj : products.find(x => x.id == obj);
        if (p) openUploadModalForProduct(p);
      };

      applyFilters(products);
    });
  </script>
  
<script src="/header.js"></script>
</body>
</html>